<?xml version="1.0" encoding="UTF-8"?>
<!--
  ! CCPL HEADER START
  !
  ! This work is licensed under the Creative Commons
  ! Attribution-NonCommercial-NoDerivs 3.0 Unported License.
  ! To view a copy of this license, visit
  ! http://creativecommons.org/licenses/by-nc-nd/3.0/
  ! or send a letter to Creative Commons, 444 Castro Street,
  ! Suite 900, Mountain View, California, 94041, USA.
  !
  ! You can also obtain a copy of the license at
  ! src/main/resources/legal-notices/CC-BY-NC-ND.txt.
  ! See the License for the specific language governing permissions
  ! and limitations under the License.
  !
  ! If applicable, add the following below this CCPL HEADER, with the fields
  ! enclosed by brackets "[]" replaced with your own identifying information:
  !      Portions Copyright [yyyy] [name of copyright owner]
  !
  ! CCPL HEADER END
  !
  !      Copyright 2011-2013 ForgeRock, Inc.
  !    
-->
<chapter xml:id='chap-intro'
 xmlns='http://docbook.org/ns/docbook'
 version='5.0' xml:lang='en'
 xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
 xsi:schemaLocation='http://docbook.org/ns/docbook http://docbook.org/xml/5.0/xsd/docbook.xsd'
 xmlns:xlink='http://www.w3.org/1999/xlink'
 xmlns:xinclude='http://www.w3.org/2001/XInclude'>
 <title>Introduction to Upgrades</title>
  <indexterm><primary>Upgrading</primary></indexterm>
  <indexterm><primary>Version Number</primary></indexterm>
  <indexterm>
   <primary>Legacy</primary>
   <secondary>Migration</secondary>
  </indexterm>
  <indexterm>
   <primary>Policy Agents</primary>
  </indexterm>
  <indexterm>
   <primary>Policy Agents</primary>
   <secondary>Java EE agents</secondary>
  </indexterm>
  <indexterm>
   <primary>Policy Agents</primary>
   <secondary>Web agents</secondary>
  </indexterm>
  <indexterm>
   <primary>Policy Agents</primary>
   <secondary>Windows IIS agents</secondary>
  </indexterm>
  <indexterm>
   <primary>Tools</primary>
   <secondary>ssoAdmin</secondary>
  </indexterm>
  <indexterm>
   <primary>Tools</primary>
   <secondary>ssoSession</secondary>
  </indexterm>
  <indexterm><primary>Distributed Authentication server</primary></indexterm>
  <indexterm>
   <primary>Best Practices</primary>
   <secondary>Customize</secondary>
  </indexterm>
  <indexterm>
   <primary>Best Practices</primary>
   <secondary>Back up</secondary>
  </indexterm>
  <indexterm>
   <primary>Best Practices</primary>
   <secondary>Restore</secondary>
  </indexterm>

 <para>This chapter provides the basic information about upgrading your OpenAM 
 deployment, whether it is a maintenance fix, a minor upgrade, or a major upgrade. 
 Understanding the differences between the different types of releases can help 
 you plan for the effort. Here is a quick breakdown of the different types of 
 procedures covered in this guide.</para>
 
 <note>
  <para>ForgeRock strongly recommends that you do not expose an OpenAM instance to 
  users during the upgrade process since running the wizard does not require
  authorization.</para>
 </note>
 
 <itemizedlist>
  
  <listitem>
   <para>Maintenance releases are applied for limited fixes and corrections. With 
   OpenAM 10.0.0 and later releases, maintenance releases are handled the same
   way as other upgrades, through the Upgrade Wizard.</para>
  </listitem>

  <listitem>
   <para>Upgrades indicate minor or major change in functionality between OpenAM 
   versions.</para>
  </listitem>

  <listitem>
   <para>Legacy releases require time and caution because they are several versions 
   behind the most recently released version (instances starting with 9.0.x and earlier).</para>
  </listitem>

  <listitem>
   <para>Other components of OpenAM, such as tools and agents, require their own
   planning, although to a much lesser degree.</para>
  </listitem>
  
 </itemizedlist>

 <para>This guide provides examples that use Apache Tomcat on a LINUX instance 
 to illustrate the procedures.</para>
 
 <section xml:id="version-numbers">
  <title>Version Numbers and Their Meaning</title> 
  
  <para>Version numbers indicate whether a release is a maintenance release, 
  a minor release, or a major release. The version number has three parts to 
  help you identify which type of upgrade you are considering.</para>
  
  <para>To better understand the numbering, we will look at a future release,
  OpenAM 11.0.1. Each of the numbers tells you something about the release.</para>
  
  <para><emphasis>11.1.2</emphasis></para>
  
  <para>The first part of the version number (11.x.x) is the major version of
  the release. If your instance is OpenAM 10.0, then you are missing out on some
  major new features included in OpenAM 11.</para>

     <!-- I'm not sure how to avoid hard-coding here -->

  <para>The second part of the version number (x.1.x) is the minor version of
   the release. If your instance is OpenAM 11.0.1, then you have missed some
   changes, like new functionality, enhancement, and bug fixes. Check out 
   the Release Notes for the OpenAM version you are considering. Links to 
   Release Notes for archived versions are available on the 
   <link xlink:show="new" xlink:href="http://forgerock.org/openam-archive.html"
     ><citetitle>Archives page</citetitle></link>. Links to Release Notes for versions 
   10.0.0 and later are available on the <link xlink:show="new" xlink:href="http://docs.forgerock.org/en/openam/"
     ><citetitle>OpenAM Access Management page</citetitle></link>.</para>
   
  <para>The third part of the version number (x.x.2) indicates the version is a
  maintenance release. These are designed to fix issues and provide very minor
  enhancements. ForgeRock encourages upgrading maintenance releases as soon 
  as reasonably possible.</para>
    
 </section>

 <section xml:id="upgrade-planning">
  <title>Planning for the Upgrade</title> 
  
  <para>You know that you need a more current version of OpenAM, but you are
  unsure which type of upgrade will fit your current needs. Here are the two
  perspectives to consider when you are faced with an upgrade.</para>
  
  <section xml:id="upgrade-admin-view">
   <title>The Administrative Perspective</title>
   
   <para>From an administrative perspective, each major release indicate a
   different set of steps to upgrade OpenAM.</para>
   
   <itemizedlist>
    <listitem>
     <para>Starting with OpenAM 10.0.0, OpenAM releases include the
     Upgrade Wizard, simplifying the upgrade process. All examples in this 
     guide are for upgrades to OpenAM 11.0.0 where the Upgrade Wizard is
     available. All releases after OpenAM 10.0.0 (including maintenance
     releases) follow the same procedure for basic upgrades; however, starting
     with OpenAM 10.1.0, session failover has been significantly changed, so
     that the process for multiple servers is different compared to all minor 
     OpenAM 10.0.x releases.</para>
    </listitem>
   </itemizedlist>

   <itemizedlist>
    <listitem>
     <para>All OpenAM 9.5 releases have a similar upgrade process as OpenAM 10.0.0
     and later releases, but the administrator must complete a few extra steps since
     the Upgrade Wizard was not available for these releases. Visit the Wikis for 
     specific examples of upgrading to an OpenAM 9.5 release.</para>
    </listitem>
   </itemizedlist>
   
   <itemizedlist>
    <listitem>
     <para>All OpenAM instances before 9.5 are considered legacy and will require
     significantly more work as your OpenAM will need to be reinstalled, not simply
     upgraded.</para>
    </listitem>
   </itemizedlist>
  </section>
  
  <section xml:id="upgrade-openam-view">
   <title>The OpenAM Perspective</title>
   
   <para>From an OpenAM perspective, the upgrade process is more complicated and is
   based on the version number.</para>
   
    <section xml:id="upgrade-mx-releases">
     <title>OpenAM Perspective for Maintenance Releases</title>
      <para>Maintenance releases have a limited effect on current functionality
      but contain necessary bug and security fixes. ForgeRock strongly recommends
      applying maintenance releases since the risk of affecting service is minimal.
      The following guidance details what was included in maintenance releases for 
      OpenAM 9.5.x and 10.x.x.</para>

       <itemizedlist>
        <para><emphasis>9.5.x</emphasis></para>
        <listitem>
          <para>Bug and security fixes</para>
        </listitem>
        <listitem>
          <para>No major changes to overall functionality</para>
        </listitem>
        <listitem>
          <para>No configuration changes because the Upgrade Wizard is not
          available in the 9.5 branch. Note this means that even after you
          upgrade, when you check the version number, it will display the version
          of your original deployment, not the version number of the upgrade.</para>
        </listitem>
       </itemizedlist>
       <itemizedlist>
        <para><emphasis>10.x.x</emphasis></para>
        <listitem>
          <para>Bug and security fixes</para>
        </listitem>
        <listitem>
          <para>No major changes to overall functionality</para>
        </listitem>
        <listitem>
          <para>Minor configuration changes with the introduction of the
          Upgrade Wizard. Once you have upgraded an OpenAM 10 deployment, 
          checking the version number will display the number of your last
          upgrade, not your original deployment.</para>
        </listitem>
       </itemizedlist>
    </section>

    <section xml:id="upgrade-new-version">
     <title>OpenAM Perspective for Major and Minor Releases</title>
       <para>Upgrading to a new version, whether it is a major or a minor
       release, should always be planned before being executed. ForgeRock
       recommends moving to the latest major and minor releases, but you 
       will need to spend time reviewing the Release Notes and determining
       a good time for testing and becoming familiar with the changes before
       you begin the upgrade.</para>
       
       <para>These changes apply to upgrades from 9.5.x to 10.x.x and from 
       10.x.x to 10.y.x.</para>

       <itemizedlist>
        <listitem>
          <para>Bug and security fixes</para>
        </listitem>
        <listitem>
          <para>New features</para>
        </listitem>
        <listitem>
          <para>Potential for older features to be deprecated or removed</para>
        </listitem>
        <listitem>
          <para>Changes to existing functionality</para>
        </listitem>
        <listitem>
          <para>Changes to components, like the configuration store or session
          repository</para>
        </listitem>
        <listitem>
          <para>Changes in the configuration and schema, the primary reason for 
          the inclusion of the Upgrade Wizard with OpenAM 10.</para>
        </listitem>
       </itemizedlist>
    </section>

    <section xml:id="migrating-legacy">
     <title>OpenAM Perspective for Migrating from a Legacy Version</title>
       <para>Migration applies to all releases prior to OpenAM 9.5, including
       Sun AM releases, OpenSSO 8 and 9, and OpenAM 9.0. The migration can be
       to any version starting with OpenAM 9.5, but ForgeRock recommends
       considering a migration to OpenAM 10 to maximize the time you will 
       have support.</para>
       
       <itemizedlist>
        <listitem>
          <para>Radical changes to functionality, components, configuration,
          and schema</para>
        </listitem>
        <listitem>
          <para>Requires a completely new installation</para>
        </listitem>
       </itemizedlist>
    </section>

  </section>
 </section> 

<!-- <section xml:id="upgrading-server-only-deployments">
  <title>Upgrading Server-Only OpenAM Deployments</title> 

  <para>For administrators that do not require the OpenAM console, the upgrade process
  is slightly different than a regular deployment upgrade. The upgrade process has not 
  been changed significantly for server-only deployments between OpenAM 9.5 and 10 
  because the Upgrade Wizard only runs from the console. The only noticeable difference
  in the upgrade process for server-only deployments is that starting with OpenAM 10.1.0
  and later releases administrators no longer need to build the <filename>.war</filename>
  file.</para>
  
 </section> -->

 <section xml:id="legacy">
  <title>Migrating from a Legacy Deployment</title> 

  <para>All deployments prior to OpenAM 9.5 are considered legacy deployments. 
  Once you have decided to do a migration, the recommended path is to migrate your
  current deployment to the most recent release. The exception is OpenAM 10.1.0, 
  which provides new technology for testing, but is not meant for use in production 
  environments.</para>
  
  <para>Upgrading a legacy deployment can be difficult. For complex and legacy 
  deployments, ForgeRock can assist you through the process. Send mail to
  <link xlink:href="mailto:info@forgerock.com">info@forgerock.com</link> for
  more information.</para>
  
 </section>

 <section xml:id="agents">
  <title>Upgrading OpenAM Components</title> 
  
  <para>There is more to OpenAM than just the core. Depending on your need, there
  are policy agents, different tools, and the Distributed Authentication server <filename>.war</filename>
  file. For each new version, make sure to look over the  <link xlink:show="new" 
  xlink:href="http://docs.forgerock.org/en/openam/"><citetitle>OpenAM Access Management 
  page</citetitle></link> to see if your OpenAM components are affected.</para>
  
   <itemizedlist>
    <para>The following are the different components that you can use with your
    OpenAM deployment.</para>
    
     <listitem>
      <para>Policy agents - Most deployments of OpenAM include a policy agent. The 
      <link xlink:href="install-guide#install-guide" xlink:role="http://docbook.org/xlink/role/olink"
      ><citetitle>Installation Guide</citetitle></link> provides information about the 
      two different types of policy agents.</para>
      <para>The examples in this guide use the Apache 2.2 web policy agent. Review the
      <link xlink:href="install-guide#install-guide" xlink:role="http://docbook.org/xlink/role/olink"
      ><citetitle>Installation Guide</citetitle></link> for your particular 
      container for information on policy agent compatibility.</para>
     </listitem>

     <listitem>
      <para>Tools - OpenAM tools include ssoAdmin, Diagnostics, and ssoConfigurator 
      tools. These tools help administrators work with OpenAM. With the OpenAM 10.1.0 
      release, the ssoSession tools were deprecated because session failover 
      was simplified.</para>
     </listitem>

     <listitem>
      <para>Distributed Authentication Servers - With OpenAM 10.1.0 forward, a new 
      <filename>distauth.war</filename> file gives you a quicker way to upgrade
      your distributed authorization with your OpenAM deployment.</para> 
     </listitem>
    
   </itemizedlist> 
 </section>
  
 <section xml:id="upgrading-best-practices">
  <title>Using Best Practices</title> 
   <para>Before you begin an upgrade, even if the upgrade is for a maintenance release,
   there are several recommendations that will help ease the process.</para>
   
   <itemizedlist>
    <listitem>
     <para>Backing up you deployment before you start the upgrade</para>
    </listitem>
    <listitem>
     <para>Customizing the <filename>.war</filename> file</para>
    </listitem>
    <listitem>
     <para>Restoring your previous instance in case you encounter issues and need
     to roll the deployment back</para>
    </listitem>
   </itemizedlist>

   <section xml:id="upgrading-backingup">
    <title>Backing up the Deployment</title>
    <para>You should always backup your deployment before you start an upgrade, even
    for maintenance releases where the changes are low risk. It is impossible to 
    predict when a change will have an adverse effect on your deployment, so make
    sure to always backup before you begin an upgrade. If you don't, you will not
    be able to roll back if you encounter problems, forcing you to deal with the 
    issues immediately, and possibly losing your previous configurations.</para>
    
    <para>Configuration data is stored in the configuration store. Full export 
    is a good way to backup your current configuration in case you need to roll  
    it back, but it may not be able to restore configuration data after an upgrade.</para>
        
   </section>

   <section xml:id="upgrading-customizing">
    <title>Handling Customization</title>
    <para>Most deployments of OpenAM are customized. Before you upgrade, you should 
    make sure you follow guidelines on handling customization.</para>
  
    <para>Customization include any changes you have made to the .war file. Some
    customizations involve changes to the configuration, which will be preserved
    during the upgrade.</para>
  
    <itemizedlist>
      
       <listitem>
        <para>Plugins and extensions, such as custom login modules, response providers
        post authentication plugins, and SAML2 attribute mappers</para>
       </listitem>
       <listitem>
        <para>Customized JSPs and callback files, such as redesigned login pages or 
        services pages, extra CSS and visual content, and modified authentication 
        module callback files</para>
       <itemizedlist>
        <listitem>
         <para>Any changes to OpenAM classes</para>
        </listitem>
        <listitem>
         <para>Any changes or additions to the Java class library</para>
        </listitem>
       </itemizedlist>
      </listitem>

    </itemizedlist>
  
    <para>Any change to your <filename>.war</filename> should be tracked for easier 
    application to future releases of OpenAM. The tracked changes can then be 
    added to newer versions.</para>
    
   </section>

   <section xml:id="restoring">
    <title>Restoring a Previous Instance</title> 
  
    <para>Sometimes a deployment does not go smoothly or a feature changes and 
    you will not have time in the foreseeable future to catch up with the latest 
    changes. You can restore your previous deployment until you have time to tackle
    the issues. This highlights the reason why you should always backup current 
    deployments before you upgrade.</para>
    
    <para>This guide does not cover OpenAM instances that are dependent on external
    replicated directory server. ForgeRock can assist you with restoring these types of
    deployments. Send mail to <link xlink:href="mailto:info@forgerock.com"
    >info@forgerock.com</link> for  more information.</para>
    
   </section>
  </section>

</chapter>
