<?xml version="1.0" encoding="UTF-8"?>
<!--
  ! CCPL HEADER START
  !
  ! This work is licensed under the Creative Commons
  ! Attribution-NonCommercial-NoDerivs 3.0 Unported License.
  ! To view a copy of this license, visit
  ! http://creativecommons.org/licenses/by-nc-nd/3.0/
  ! or send a letter to Creative Commons, 444 Castro Street,
  ! Suite 900, Mountain View, California, 94041, USA.
  !
  ! You can also obtain a copy of the license at
  ! src/main/resources/legal-notices/CC-BY-NC-ND.txt.
  ! See the License for the specific language governing permissions
  ! and limitations under the License.
  !
  ! If applicable, add the following below this CCPL HEADER, with the fields
  ! enclosed by brackets "[]" replaced with your own identifying information:
  !      Portions Copyright [yyyy] [name of copyright owner]
  !
  ! CCPL HEADER END
  !
  !      Copyright 2011-2013 ForgeRock, Inc.
   !    
-->
<chapter xml:id='chap-update-agents'
 xmlns='http://docbook.org/ns/docbook'
 version='5.0' xml:lang='en'
 xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
 xsi:schemaLocation='http://docbook.org/ns/docbook http://docbook.org/xml/5.0/xsd/docbook.xsd'
 xmlns:xlink='http://www.w3.org/1999/xlink'
 xmlns:xinclude='http://www.w3.org/2001/XInclude'>
<title>Updating Policy Agents</title>
 <indexterm>
  <primary>Policy Agents</primary>
 </indexterm>

 <para>This chapter briefly describes the update process for OpenAM
 policy agents. Before you begin updating your policy agent, evaluate the changes
 in the Release Notes on the <link xlink:href="http://forgerock.org/openam.html">
 <citetitle>OpenAM Downloads page</citetitle></link> for your container.</para> 

 <procedure xml:id="update-same-major-version-agents">
  <title>To Update Version 3 Policy Agents</title>
  
  <para>The most current version of all of the policy agents is version 3. Follow these 
  steps to update a version 3 policy agent to a more recent version 3 release.</para>

  <step>
   <para>Verify that the JAVA_HOME is properly set.</para>
  </step>
  <step>
   <para>For a web policy agent, backup the <filename>web_agents/</filename> 
   directory. For Java EE policy agents, back up the <filename>j2ee_agents/</filename> 
   directory.</para>
  </step>
  <step>
   <para>Extract the <filename>.zip</filename> for the new release over the existing 
   policy agent files, replacing the current version with the new version.</para>
  </step>
   <para>Backup the file system directory where the existing policy agent is
   installed.</para>
  <step>
   <para>When upgrading a Java EE agent, replace the deployed policy agent
   application with the new version.</para>
  </step>
  <step>
   <para>Restart the web server, web container, or policy agent.</para>
   <para>At this point, new configuration parameters introduced since the
   release of the earlier policy agent have not yet been set, and so the
   policy agent uses the default values until you change the
   configuration.</para>
  </step>
 </procedure>

 <example xml:id="update-agent-example">
 <?dbfo keep-together="auto"?>
  <title>Updating Apache 2.2 Policy Agent Example</title>
  
  <para>The following example updates the Apache 2.2 web policy agent from version 
  3.0.3 release to Apache 2.2 version 3.0.4.</para>
   
  <orderedlist numberation="arabic">
   <listitem>
    <para>Verify that the JAVA_HOME is properly set.</para>
    <screen>echo $JAVA_HOME
 /path/to/java-6-sun</screen>
   </listitem>

   <listitem>
    <para>Backup the web_agents directory.</para>

    <screen>$ cp -r /path/to/web_agents /path/to/backup</screen>
   </listitem>

   <listitem>
    <para>Download the most recent Apache 2.2 file from the
    <link xlink:href="http://forgerock.org/openam.html"
    ><citetitle>OpenAM Download Page</citetitle></link>.</para>
   </listitem>   
   
   <listitem>
    <para>Shutdown Tomcat.</para>
    <screen>$ cd /path/to/tomcat
$ ./bin/shutdown.sh</screen>
   </listitem>

   <listitem>
    <para>Stop Apache.</para>
    <screen>$ sudo /path/to/init.d/apache2 stop</screen>
   </listitem>

   <listitem>
    <para>Replace the older version of the policy agent file by unzipping into the same 
    directory as your current policy agent.</para>
    <screen>$ cd /path/to/web_agent
$ unzip ~/Downloads/apache_v22_Linux_64_agent_3.0.4.zip

Archive:  /path/apache_v22_Linux_64_agent_3.0.4.zip
   creating: web_agents/
   creating: web_agents/apache22_agent/
   ...</screen>
   </listitem>
  
   <listitem>
    <para>Restart Apache.</para>
    <screen>$ sudo /path/to/init.d/apache2 start</screen>
   </listitem>
  
   <listitem>
    <para>Restart Tomcat.</para>
    <screen>$ cd /path/to/tomcat
$ ./bin/startup.sh</screen>
   </listitem>
   
   <listitem>
    <para>Reconfigure your instance to include new configuration parameters 
    introduced since the release.</para>
   </listitem>
  </orderedlist>

 </example>

</chapter>
