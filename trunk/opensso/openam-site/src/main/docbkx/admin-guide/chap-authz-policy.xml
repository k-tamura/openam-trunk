<?xml version="1.0" encoding="UTF-8"?>
<!--
  ! CCPL HEADER START
  !
  ! This work is licensed under the Creative Commons
  ! Attribution-NonCommercial-NoDerivs 3.0 Unported License.
  ! To view a copy of this license, visit
  ! http://creativecommons.org/licenses/by-nc-nd/3.0/
  ! or send a letter to Creative Commons, 444 Castro Street,
  ! Suite 900, Mountain View, California, 94041, USA.
  !
  ! You can also obtain a copy of the license at
  ! src/main/resources/legal-notices/CC-BY-NC-ND.txt.
  ! See the License for the specific language governing permissions
  ! and limitations under the License.
  !
  ! If applicable, add the following below this CCPL HEADER, with the fields
  ! enclosed by brackets "[]" replaced with your own identifying information:
  !      Portions Copyright [yyyy] [name of copyright owner]
  !
  ! CCPL HEADER END
  !
  !      Copyright 2011 ForgeRock AS
  !    
-->
<chapter xml:id='chap-authz-policy'
 xmlns='http://docbook.org/ns/docbook'
 version='5.0' xml:lang='en'
 xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
 xsi:schemaLocation='http://docbook.org/ns/docbook http://docbook.org/xml/5.0/xsd/docbook.xsd'
 xmlns:xlink='http://www.w3.org/1999/xlink'
 xmlns:xinclude='http://www.w3.org/2001/XInclude'>
 <title>Defining Authorization Policies</title>

 <para><firstterm>Authorization</firstterm> is determining whether to grant or
 deny a user access to a resource. <firstterm>Policies</firstterm> define how
 to determine whether to grant or deny access. This chapter describes how to
 configure authorization policies managed by OpenAM.</para>
 
 <section xml:id="what-is-authz">
  <title>About Authorization in OpenAM</title>
  
  <para>Applications rely on OpenAM for access management, which breaks down
  into authentication, or determining who is trying to access a resource,
  and authorization, or determining whether to grant or deny access. This
  is because whether access is granted generally depends on what the rules
  about access are, who is trying to gain access, and perhaps some other
  conditions, such as whether the access itself needs to happen over a
  secure channel or what time of day it is. To return to the international
  airport example, the rule may be that passengers with valid passports and
  visa presenting valid plane tickets are allowed through to the gate where the
  plane is waiting to take off, but only under the condition that the plane
  is going to leave soon. (You cannot expect to get to the gate today with a
  scheduled departure for three months from now.)</para>
  
  <para>To allow OpenAM to determine whether to grant access, you define
  authorization policies. A policy includes <firstterm>rules</firstterm>
  that match what resources a user aims to access in what way and whether to
  grant or deny that access, <firstterm>subjects</firstterm> to whom the
  policy applies, and potentially <firstterm>conditions</firstterm> under
  which the policy applies. When queried about whether to let a user through
  to a protected resource, OpenAM decides to authorize access or not based on
  the applicable policy. OpenAM then communicates its decision to the
  application using OpenAM for access management, or in the common case to the
  policy agent installed in the server where the application runs. The
  application or the agent then enforces the authorization decision from
  OpenAM.</para>
  
  <para>For example, consider the case where OpenAM protects a web site
  page that users access to update their profiles. An OpenAM policy agent
  installed in the web server intercepts client requests to enforce policy.
  The policy says that authenticated users can access the page to update their
  profiles as long come in over HTTPS, rather than HTTP.</para>
  
  <para>When a user browses to the page to update her profile, the OpenAM
  policy agent intercepts the request. The policy agent notices that the
  request is to access a protected resource, but the request is coming from a
  user who has not yet logged in and has no authorization to visit the page.
  The agent therefore redirects the user to OpenAM.</para>
  
  <para>OpenAM receives the redirected user, serving a login page that
  collects her email and password. With the email and password credentials,
  OpenAM authenticates the user, and gives her a session. OpenAM checks the
  policy that matches the page she wants to access, and grants access to the
  page, giving the user's browser a cookie to show the policy agent.
  OpenAM redirects the user's browser back to the page to update her profile.
  The policy agent notices that the user has been granted access, and so
  lets the user access the page. As she now has a session on OpenAM, the
  user can go away to another page in her browser, come back to the update
  profile page while the session is still valid, and gain access without having
  to enter her email and password again.</para>
  
  <para>Notice how OpenAM and the policy agent handle the access in the
  example. The web site developer can offer a profile page, but the web site
  developer never has to manage login, nor has to handle who can access a page.
  As OpenAM administrator, you can change authentication and authorization
  independently of updates to the web site. You might need to agree with web
  site developers on how OpenAM identifies users so web developers can find
  their particular profiles, or identify the user by her own name when she logs
  in. Yet your organization is now spared from new web site development
  projects when you want to add external access to your Intranet for roaming
  users, open certain of your sites to partners, only let managers access
  certain pages of your HR web site, or allow users already logged in to their
  desktops to visit protected web sites without having to type their user names
  and passwords again.</para>
  
  <para>Policies can be extended to implement <firstterm>response
  providers</firstterm>, which extends HTTP headers for authorized access,
  and to send <firstterm>advice</firstterm>. OpenAM can be configured to
  send advice for example when authorization results in access being denied,
  though in fact the reason for the denial was obviously something that
  could be corrected by further authentication. For instance, suppose a
  user comes to a web site having authenticated with an email address and
  password, which is configured as authentication level 0. Had the user
  authenticated over the VPN which relies on one-time password authentication,
  she would have had authentication level 1 in her session. Yet, because she
  has authentication level 0, she currently cannot access the page she wants,
  which requires authentication level 1. OpenAM can send advice in this case,
  prompting the agent or application to redirect her to authenticate again with
  a one-time password, gaining authentication level 1, and thus having OpenAM
  grant her access to the protected page.</para>
 </section>

</chapter>
