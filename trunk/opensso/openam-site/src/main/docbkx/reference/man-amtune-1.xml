<?xml version="1.0" encoding="UTF-8"?>
<!--
  ! CCPL HEADER START
  !
  ! This work is licensed under the Creative Commons
  ! Attribution-NonCommercial-NoDerivs 3.0 Unported License.
  ! To view a copy of this license, visit
  ! http://creativecommons.org/licenses/by-nc-nd/3.0/
  ! or send a letter to Creative Commons, 444 Castro Street,
  ! Suite 900, Mountain View, California, 94041, USA.
  !
  ! You can also obtain a copy of the license at
  ! src/main/resources/legal-notices/CC-BY-NC-ND.txt.
  ! See the License for the specific language governing permissions
  ! and limitations under the License.
  !
  ! If applicable, add the following below this CCPL HEADER, with the fields
  ! enclosed by brackets "[]" replaced with your own identifying information:
  !      Portions Copyright [yyyy] [name of copyright owner]
  !
  ! CCPL HEADER END
  !
  !      Copyright 2011 ForgeRock AS
  !    
-->
<refentry xml:id='amtune-1'
 xmlns='http://docbook.org/ns/docbook'
 version='5.0' xml:lang='en'
 xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
 xsi:schemaLocation='http://docbook.org/ns/docbook http://docbook.org/xml/5.0/xsd/docbook.xsd'
 xmlns:xlink='http://www.w3.org/1999/xlink'
 xmlns:xinclude='http://www.w3.org/2001/XInclude'>
 <refmeta>
  <refentrytitle>amtune</refentrytitle><manvolnum>1</manvolnum>
 </refmeta>
 <refnamediv>
  <refname>amtune</refname>
  <refpurpose>tune OpenAM, container, and operating system</refpurpose>
 </refnamediv>
 <refsynopsisdiv>
  <cmdsynopsis>
   <command>amtune</command>
   <arg choice="req">options</arg>
  </cmdsynopsis>
 </refsynopsisdiv>
 <refsect1>
  <title>Description</title>
  <para>This command helps you tune OpenAM parameters such as session/SDK
  cache entries, logging buffers, notification thread pool/queue and LDAP
  connection pool sizes for service management, global authentication services,
  and the user data stores. The <command>amtune</command> command also helps
  you tune JVM heap and JVM per-thread stack sizes, JVM garbage collection
  algorithms, container worker/acceptor threads and queue sizes on Sun Web
  Server and Glassfish, and helps you tune Solaris and Linux system
  parameters.</para>
 </refsect1>
 <refsect1>
  <title>Run Modes</title>
  <para>This command can be run in REVIEW mode to gather tuning information,
  or in CHANGE mode to make changes. To change modes, edit the value of
  <literal>AMTUNE_MODE</literal> in <filename>amtune-env.properties</filename>
  located in the same directory as <command>amtune</command>.</para>
  <programlisting>AMTUNE_MODE=REVIEW</programlisting>
  <para>Login as super user to run the command.</para>
 </refsect1>
 <refsect1>
  <title>Files</title>
  <para>The <command>amtune</command> command uses the configuration file,
  <filename>amtune-env.properties</filename> located in the same directory as
  the command. Read the comments in the file to determine what properties to
  set before running the command.</para>
  <para>To connect to servers to tune, <command>amtune</command> requires
  as read-only password file, based on the template,
  <filename>amtune-samplepasswordfile</filename> located in the same directory
  as the command.</para>
 </refsect1>
 <refsect1>
  <title>Examples</title>
  <para>The following example runs the command in REVIEW mode.</para>
  <screen># su
Password:
# echo DIRMGR_PASSWORD=password &gt; pwd.file
# echo SSOADM_PASSWORD=password &gt;&gt; pwd.file
# chmod 400 /tmp/pwd.file
# vi amtune-env.properties
# grep -E "^[A-Z_]*=.+" amtune-env.properties
AMTUNE_MODE=REVIEW
AMTUNE_LOG_LEVEL=FILE
AMTUNE_TUNE_OS=true
AMTUNE_TUNE_DS=false
AMTUNE_TUNE_WEB_CONTAINER=false
AMTUNE_TUNE_OPENSSO=true
WEB_CONTAINER=other
AMTUNE_WEB_CONTAINER_JAVA_POLICY=false
SSOADM_LOCATION=/home/mark/tools/admin/openam/bin
OPENSSOADMIN_USER=amadmin
OPENSSOSERVER_URL=http://openam.example.com:8080/openam
REALM_NAME=/
AMTUNE_PCT_MEMORY_TO_USE=75
AMTUNE_MEM_MAX_HEAP_SIZE_RATIO=7/8
AMTUNE_MEM_MIN_HEAP_SIZE_RATIO=1/2
AMTUNE_PER_THREAD_STACK_SIZE_IN_KB=128
AMTUNE_MIN_MEMORY_TO_USE_IN_MB=512
AMTUNE_MAX_MEMORY_TO_USE_IN_MB_SOLARIS=3584
AMTUNE_MAX_MEMORY_TO_USE_IN_MB_DEFAULT=1536
# # amtune ./pwd.file
=====================================================================
Error log file :
 /home/mark/tools/admin/openam/bin/amtune/../../logs/amtune-errors
Configuration information file :
 /home/mark/tools/.../logs/amtune-config.2011-08-15-14-50-05.log
=====================================================================
Checking System Environment...
Checking User...
---------------------------------------------------------------------
OpenSSO tune information...
---------------------------------------------------------------------
amtune Mode      : REVIEW
OS               : true 
OpenAM          : true 
Directory        : false 
Web Container    : false 
---------------------------------------------------------------------
Detecting System Environment...
---------------------------------------------------------------------
Number of Cores in the system : 1 
Acceptor Threads : 1 
Memory Available (MB) : 2023 
Memory to Use (MB) : 1517 
There is enough memory.
---------------------------------------------------------------------
Calculating Tuning Parameters...
---------------------------------------------------------------------
Max heap size (MB) : 1327 
Min Heap size (MB) : 1327 
Max new size (MB) : 165 
Session Cache Size (MB) : 442 
Number of Session Cache Entries : 75434 
Maximum Number of Java Threads : 663 
Maximum Number of Thread Pool : 276 
LDAP Auth Threads : 27 
Service management LDAP Threads : 27 
Notification Threads : 3 
Notification Queue Size : 22627 
=====================================================================
Linux Tuning 
---------------------------------------------------------------------
Linux Kernel Tuning...
 
File                 : /etc/sysctl.conf
Parameter tuning     : 
 
1.   fs.file-max
Current Value        : fs.file-max =  
Recommended Value    : fs.file-max = 65536
 
2.   net.ipv4.ip_local_port_range
Current Value        : net.ipv4.ip_local_port_range = 32768 61000
Recommended Value    : net.ipv4.ip_local_port_range = 1204 65000
 
3.   net.core.rmem_max
Current Value        : net.core.rmem_max = 131071
Recommended Value    : net.core.rmem_max = 8388608
 
4.   net.ipv4.tcp_rmem
Current Value        : net.ipv4.tcp_rmem = 4096 87380 3473408
Recommended Value    : net.ipv4.tcp_rmem = 4096 131072 8388608
 
5.   net.ipv4.tcp_wmem
Current Value        : net.ipv4.tcp_wmem = 4096 16384 3473408
Recommended Value    : net.ipv4.tcp_wmem = 4096 131072 8388608
 
6.   net.ipv4.tcp_sack
Current Value        : net.ipv4.tcp_sack = 1
Recommended Value    : net.ipv4.tcp_sack = 0
 
7.   net.ipv4.tcp_timestamps
Current Value        : net.ipv4.tcp_timestamps = 1
Recommended Value    : net.ipv4.tcp_timestamps = 0
 
8.   net.ipv4.tcp_window_scaling
Current Value        : net.ipv4.tcp_window_scaling = 1
Recommended Value    : net.ipv4.tcp_window_scaling = 0
 
9.  net.ipv4.tcp_keepalive_time
Current Value        : net.ipv4.tcp_keepalive_time = 7200
Recommended Value    : net.ipv4.tcp_keepalive_time = 60
 
10.  net.ipv4.tcp_keepalive_intvl
Current Value        : net.ipv4.tcp_keepalive_intvl = 75
Recommended Value    : net.ipv4.tcp_keepalive_intvl = 75
 
11.  net.ipv4.tcp_fin_timeout
Current Value        : net.ipv4.tcp_fin_timeout = 60
Recommended Value    : net.ipv4.tcp_fin_timeout = 30
 
---------------------------------------------------------------------
Linux Boot Script Tuning...
 
File                 : /etc/rc.local
Parameter tuning     : 
 
1.   /proc/sys/net/ipv4/tcp_fin_timeout
Current Value        : 
Recommended Value    : echo 30 &gt; /proc/sys/net/ipv4/tcp_fin_timeout
 
2.   /proc/sys/net/ipv4/tcp_keepalive_time
Current Value        : 
Recommended Value    : echo 60 &gt; /proc/sys/net/ipv4/tcp_keepalive_time
 
3.   /proc/sys/net/ipv4/tcp_keepalive_intvl
Current Value        : 
Recommended Value    : echo 75 &gt; /proc/sys/net/ipv4/tcp_keepalive_intvl
 
4.   /proc/sys/net/ipv4/tcp_window_scaling
Current Value        : 
Recommended Value    : echo 0 &gt; /proc/sys/net/ipv4/tcp_window_scaling
 
5.   Loading Kernel file with sysctl -p /etc/sysctl.conf
Current Value        : 
Recommended Value    : sysctl -p /etc/sysctl.conf
 
---------------------------------------------------------------------
Open file and File Descriptors Tuning...
 
File                 : /etc/security/limits.conf
Parameter tuning     : 
 
1.   Number of Soft files.
Current Value        :  
Recommended Value    : *               soft    nofile          65536
 
2.   Number of Hard files.
Current Value        :  
Recommended Value    : *               hard    nofile          65536
 
=====================================================================
#####################################################################
OpenAM Tuning.....
#####################################################################
Initializing...
---------------------------------------------------------------------
Recommended OpenAM Server tuning parameters are...
 
Parameter tuning     : 
 
1.    com.iplanet.am.sdk.cache.maxSize
Current Value        : com.iplanet.am.sdk.cache.maxSize=&lt;No value set&gt;
Recommended Value    : com.iplanet.am.sdk.cache.maxSize=10000
 
2.    com.iplanet.am.notification.threadpool.size
Current Value        : com.iplanet.am.notification.threadpool.size=
 &lt;No value set&gt;
Recommended Value    : com.iplanet.am.notification.threadpool.size=3
 
3.    com.iplanet.am.notification.threadpool.threshold
Current Value        : com.iplanet.am.notification.threadpool.threshold=
 &lt;No value set&gt;
Recommended Value    : com.iplanet.am.notification.threadpool.threshold=22627
 
4.    com.iplanet.am.session.maxSessions
Current Value        : com.iplanet.am.session.maxSessions=&lt;No value set&gt;
Recommended Value    : com.iplanet.am.session.maxSessions=75434
 
5.    com.iplanet.am.session.purgedelay
Current Value        : com.iplanet.am.session.purgedelay=&lt;No value set&gt;
Recommended Value    : com.iplanet.am.session.purgedelay=0
 
6.    com.iplanet.am.session.invalidsessionmaxtime
Current Value        : com.iplanet.am.session.invalidsessionmaxtime=
 &lt;No value set&gt;
Recommended Value    : com.iplanet.am.session.invalidsessionmaxtime=3
...</screen>
 </refsect1>
</refentry>
